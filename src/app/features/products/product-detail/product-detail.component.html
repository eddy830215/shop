<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalles del Producto - Tienda Eddy</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
    
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .quantity-input {
      @apply w-16 sm:w-20 text-center border border-gray-300 rounded-lg py-1 sm:py-2 px-2 sm:px-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base;
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="container mx-auto px-3 sm:px-4 py-4 sm:py-6">
    <!-- Botón de regreso -->
    <button 
      (click)="goBack()"
      class="flex items-center text-purple-600 hover:text-purple-700 mb-3 sm:mb-6 transition-all duration-150 active:scale-95 text-sm sm:text-base fade-in"
      appClickLogger="Volver a productos">
      <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Back to products
    </button>

    <!-- Estado de carga -->
    <div *ngIf="loading()" class="flex justify-center items-center py-12 sm:py-16 fade-in">
      <div class="animate-spin rounded-full h-10 w-10 sm:h-12 sm:w-12 border-b-2 border-purple-500"></div>
    </div>

    <!-- Error -->
    <div *ngIf="error() && !loading()" class="bg-red-50 border border-red-200 rounded-lg p-4 sm:p-6 text-center max-w-2xl mx-auto fade-in">
      <div class="text-red-500 mb-3 sm:mb-4">
        <svg class="w-10 h-10 sm:w-12 sm:h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/>
        </svg>
      </div>
      <h2 class="text-lg sm:text-xl font-semibold text-red-800 mb-2">Error loading product</h2>
      <p class="text-red-600 mb-3 sm:mb-4 text-sm sm:text-base">{{ error() }}</p>
      <button 
        (click)="loadProduct()"
        class="bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white px-4 py-2 rounded-lg transition-all duration-150 active:scale-95 focus:outline-none focus:ring-2 focus:ring-purple-200 text-sm sm:text-base">
        Retry
      </button>
    </div>

    <!-- Detalles del producto -->
    <div *ngIf="product() && !loading()" class="max-w-6xl mx-auto fade-in">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 mb-8 sm:mb-12">
        <!-- Imagen del producto -->
        <div class="flex flex-col">
          <div class="bg-white rounded-lg shadow-lg p-3 sm:p-4 lg:p-6 mb-2 sm:mb-3">
            <img 
              [src]="product().image" 
              [alt]="product().title"
              class="w-full h-40 sm:h-56 lg:h-64 xl:h-72 object-contain transition-transform duration-300 hover:scale-105">
          </div>
          
          <!-- Miniaturas -->
          <div class="grid grid-cols-4 gap-1 sm:gap-2">
            <div 
              *ngFor="let i of [1,2,3,4]; trackBy: trackByIndex" 
              class="bg-white border border-gray-200 rounded-lg p-1 sm:p-2 cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:border-purple-500 hover:shadow-md active:scale-95">
              <img 
                [src]="product().image" 
                [alt]="product().title + ' thumbnail ' + i"
                class="w-full h-10 sm:h-12 lg:h-14 object-contain">
            </div>
          </div>
        </div>

        <!-- Información del producto -->
        <div class="flex flex-col">
          <!-- Categoría -->
          <span class="text-purple-600 font-medium mb-1 sm:mb-2 uppercase tracking-wide text-xs sm:text-sm">
            {{ product().category }}
          </span>

          <!-- Título -->
          <h1 class="text-lg sm:text-xl lg:text-2xl xl:text-3xl font-bold text-gray-900 mb-2 sm:mb-3 leading-tight">
            {{ product().title }}
          </h1>

          <!-- Rating -->
          <div class="flex items-center mb-3 sm:mb-4">
            <div class="flex items-center">
              <ng-container *ngIf="getStarRating(product().rating.rate) as rating">
                <!-- Estrellas llenas -->
                <svg *ngFor="let star of getArray(rating.full); trackBy: trackByIndex" 
                     class="w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                
                <!-- Media estrella -->
                <svg *ngIf="rating.half" class="w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                
                <!-- Estrellas vacías -->
                <svg *ngFor="let star of getArray(rating.empty); trackBy: trackByIndex" 
                     class="w-3 h-3 sm:w-4 sm:h-4 lg:w-5 lg:h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </ng-container>
            </div>
            <span class="ml-1 sm:ml-2 text-xs sm:text-sm text-gray-600">
              {{ product().rating.rate }} ({{ product().rating.count }} reviews)
            </span>
          </div>

          <!-- Precio -->
          <div class="mb-3 sm:mb-4">
            <span class="text-xl sm:text-2xl lg:text-3xl font-bold text-purple-600">
              {{ product().price | currency }}
            </span>
            <span class="text-xs sm:text-sm text-gray-500 ml-1 sm:ml-2">VAT included</span>
          </div>

          <!-- Descripción -->
          <div class="mb-4 sm:mb-6">
            <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-1 sm:mb-2">Description</h3>
            <p class="text-gray-700 leading-relaxed text-sm sm:text-base">
              {{ product().description }}
            </p>
          </div>

          <!-- Formulario de compra -->
          <div class="bg-gray-50 rounded-lg p-3 sm:p-4 mb-3 sm:mb-4">
            <h3 class="text-base sm:text-lg font-semibold text-gray-900 mb-2 sm:mb-3">Buy product</h3>
            
            <!-- Selector de cantidad -->
            <div class="mb-2 sm:mb-3">
              <label class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                Amount
              </label>
              <div class="flex items-center space-x-1 sm:space-x-2">
                <button
                  type="button"
                  (click)="decrementQuantity()"
                  [disabled]="getQuantityValue() <= 1"
                  class="w-7 h-7 sm:w-8 sm:h-8 lg:w-10 lg:h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150 active:scale-95 text-sm sm:text-base"
                  appClickLogger="Decrementar cantidad">
                  <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                  </svg>
                </button>
                <input
                  type="number"
                  [formControl]="quantity"
                  class="quantity-input rounded-lg"
                  min="1"
                  max="10"
                >
                <button
                  type="button"
                  (click)="incrementQuantity()"
                  [disabled]="getQuantityValue() >= 10"
                  class="w-7 h-7 sm:w-8 sm:h-8 lg:w-10 lg:h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-150 active:scale-95 text-sm sm:text-base"
                  appClickLogger="Incrementar cantidad">
                  <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                  </svg>
                </button>
              </div>
              
              <!-- Errores de validación -->
              <div *ngIf="quantity.invalid && quantity.touched" class="mt-1 text-xs sm:text-sm text-red-600">
                <div *ngIf="quantity.errors?.['required']">The required quantity</div>
                <div *ngIf="quantity.errors?.['min']">The minimum amount is 1</div>
                <div *ngIf="quantity.errors?.['max']">The maximum amount is 10</div>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
              <button
                type="button"
                (click)="addToCart()"
                [disabled]="quantityForm.invalid"
                class="flex-1 bg-gradient-to-r from-purple-500 to-indigo-600 text-white py-2 sm:py-3 px-3 sm:px-4 rounded-lg font-semibold
                      hover:from-purple-600 hover:to-indigo-700 
                      active:scale-95
                      disabled:opacity-50 
                      disabled:cursor-not-allowed 
                      transition-all
                      duration-150 
                      shadow-md
                      flex items-center
                      hover:shadow-lg 
                      justify-center
                      text-sm sm:text-base"
                appClickLogger="Add to cart from details">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 sm:w-5 sm:h-5 mr-2">
                  <path d="M1 1.75A.75.75 0 0 1 1.75 1h1.628a1.75 1.75 0 0 1 1.734 1.51L5.18 3a65.25 65.25 0 0 1 13.36 1.412.75.75 0 0 1 .58.875 48.645 48.645 0 0 1-1.618 6.2.75.75 0 0 1-.712.513H6a2.503 2.503 0 0 0-2.292 1.5H17.25a.75.75 0 0 1 0 1.5H2.76a.75.75 0 0 1-.748-.807 4.002 4.002 0 0 1 2.716-3.486L3.626 2.716a.25.25 0 0 0-.248-.216H1.75A.75.75 0 0 1 1 1.75ZM6 17.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM15.5 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" />
                </svg>                           
                Add to Cart
              </button>
              
              <button 
               type="button" 
               (click)="buyNow()" 
               [disabled]="quantityForm.invalid" 
               class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2 sm:py-3 px-3 sm:px-4 rounded-lg font-semibold 
                       hover:from-green-600 hover:to-green-700 
                       active:scale-95 
                       disabled:opacity-50 
                       disabled:cursor-not-allowed 
                       transition-all 
                       duration-150 
                       shadow-md 
                       hover:shadow-lg
                       text-sm sm:text-base" 
                       appClickLogger="Buy now">
                       Buy now
              </button>
            </div>
          </div>

          <!-- Información adicional -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3 text-xs sm:text-sm text-gray-600">
            <div class="flex items-center">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
              In stock
            </div>
            <div class="flex items-center">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
              </svg>
              Free shipping
            </div>
            <div class="flex items-center">
              <svg class="w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 15v-1a4 4 0 00-4-4H8m0 0l3 3m-3-3l3-3m9 14V5a2 2 0 00-2-2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2z"/>
              </svg>
              Warranty
            </div>
          </div>
        </div>
      </div>

      <!-- Productos relacionados -->
      <div *ngIf="relatedProducts().length > 0" class="border-t border-gray-200 pt-6 sm:pt-8">
        <h2 class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900 mb-4 sm:mb-6">Related Products</h2>
        <div class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
          <div 
            *ngFor="let relatedProduct of relatedProducts(); trackBy: trackByProductId"
            class="bg-white rounded-lg shadow-md cursor-pointer hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 active:scale-95"
            [routerLink]="['/products', relatedProduct.id]"
            appClickLogger="Related Products">
            <div class="p-2 sm:p-3">
              <img 
                [src]="relatedProduct.image" 
                [alt]="relatedProduct.title"
                class="w-full h-24 sm:h-28 lg:h-32 object-contain mb-2 sm:mb-3">
              <h3 class="font-semibold text-xs sm:text-sm lg:text-base mb-1 sm:mb-2 line-clamp-2 leading-tight">
                {{ (relatedProduct.title | slice:0:40) + (relatedProduct.title.length > 40 ? '...' : '') }}
              </h3>
              <div class="flex items-center justify-between">
                <span class="text-base sm:text-lg font-bold text-purple-600">
                  {{ relatedProduct.price | currency }}
                </span>
                <div class="flex items-center text-xs sm:text-sm text-gray-600">
                  <span class="text-yellow-400 mr-1">★</span>
                  {{ relatedProduct.rating.rate }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>